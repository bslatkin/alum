<html>
<head>

<style type="text/css">

.slot {
  cursor: move;
  border: 1px solid black;
  padding: 0px;
  marign: 0px;
}

.slot-static {
  background-color: #ccc;
  z-index: 1;
}

.slot-dragging {
  background-color: #aaa;
  z-index: 10000;
}

#gridcontainer {
  margin: 0;
  padding: 0px;
  border: 1px solid red;
}

#shelfcontainer {
  
}

</style>

<link type="text/css" href="jquery/css/smoothness/jquery-ui-1.7.2.custom.css" rel="stylesheet" />	
<script type="text/javascript" src="jquery/js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="jquery/js/jquery-ui-1.7.2.custom.min.js"></script>

<script type="text/javascript">
  // inputs
  var diagramWidth = 500;
  var diagramHeight = 250;
  var numColumns = 4;
  var numRows = 3;
  var gridWidth = Math.floor(diagramWidth / numColumns);
  var gridHeight = Math.floor(diagramHeight / numRows);
  // Readjust total layout size for weight floating point values.
  diagramWidth = numColumns * gridWidth;
  diagramHeight = numRows * gridHeight;
  var gridColumns = [];

  // Convert grid slot to pixel location.
  function gridPixelsX(x) {
    return (gridWidth) * x;
  }
  function gridPixelsY(y) {
    return (gridHeight) * y;
  }

  // Convert pixel location to grid slots. Returns [{x: N, y: M}, ...]
  function getGridSlots(top, left, bottom, right) {
    var foundSlots = [];
    for (var x = 0; x < numColumns; ++x) {
      for (var y = 0; y < numRows; ++y) {
        var pixelX = gridPixelsX(x);
        var pixelY = gridPixelsY(y);
        if (bottom >= pixelY &&
            top <= pixelY &&
            right >= pixelX &&
            left <= pixelX) {
          console.log("pixelxy=" + pixelX + "," + pixelY + " to: " +
                      "left=" + left + " top=" + top +
                      " right=" + right + " bottom=" + bottom +
                      "; overlapping: x=" + x + ", y=" + y);
          foundSlots.push({"x": x, "y": y});
        }
      }
    }
    return foundSlots;
  }

  ///// Event handling
  function startDragOrResize(event, ui) {
    ui.helper.addClass("slot-dragging").removeClass("slot-static");
  }
  function stopDragOrResize(event, ui) {
    var position = ui.helper.position();
    ui.helper.addClass("slot-static").removeClass("slot-dragging");
    var gridSlots = getGridSlots(
        position.top,
        position.left,
        position.top + ui.helper.innerHeight(),
        position.left + ui.helper.innerWidth());
  }

  $(document).ready(function() {
    $("#gridcontainer").css({"width": diagramWidth,
                             "height": diagramHeight,
                             "position": "absolute"});

    for (var x = 0; x < numColumns; ++x) {
      var row = []
      gridColumns[x] = row;
      for (var y = 0; y < numRows; ++y) {
        // Create a grid of draggables.
        $("<div style='draggable ui-widget-header'>" + x + ", " + y + "</div>")
            .addClass("slot")
            .addClass("slot-static")
            .data("x", x)
            .data("y", y)
            .css({"width": (gridWidth-2) + "px",
                  "height": (gridHeight-2) + "px",
                  "left": gridPixelsX(x),
                  "top": gridPixelsY(y),
                  "position": "absolute"})
            .draggable({"grid": [gridWidth, gridHeight],
                        "containment": "parent",
                        "zIndex": 0,
                        "start": startDragOrResize,
                        "stop": stopDragOrResize})
            .resizable({"grid": [gridWidth, gridHeight],
                        "minWidth": gridWidth,
                        "minHeight": gridHeight,
                        "maxWidth": diagramWidth,
                        "maxHeight": diagramHeight,
                        "containment": "parent",
                        "start": startDragOrResize,
                        "stop": stopDragOrResize})
            .appendTo("#gridcontainer");
        row[y] = {
          slot: null
        }
      }
    }
  });
</script>

</head>
<body>

<!-- containing div that's got the screen resolution scaled to the grid size -->
<!-- list on the right to select the different numbers -->
<!-- dialog to change the numbers of each with a button -->
<!-- if you drag an element overlapping others, the others will go off to the
right side in the shelf -->

<div id="gridcontainer"></div>

<div id="shelfcontainer"></div>

</body>
</html>
